import numpy as np
from scipy.fft import dct, idct
import matplotlib.pyplot as plt

list = np.zeros((128, 128), dtype=float)

with open('out.txt', 'r') as file:
    data = file.read()
    numbers = data.split()
    list = np.array(numbers, dtype=float).reshape(128, 128)

inpImg = np.zeros((128, 128), dtype=float)

with open('in.txt', 'r') as file:
    data = file.read()
    numbers = data.split()
    new = []
    for i in numbers:
        new.append(int(i[:-1], 2))
    inpImg = np.array(new, dtype=float).reshape(128, 128)

# quant_table = np.array([
#     [16,  11,  10,  16,  24, 40, 51, 61],
#     [12,  12,  14,  19,  26, 58, 60, 55],
#     [14,  13,  16,  24, 40, 57, 69, 56],
#     [14,  17, 22,  29, 51, 87, 80, 62],
#     [18,  22, 37, 56, 68, 109, 103, 77],
#     [24, 35, 55, 64, 81, 104, 113, 92],
#     [49, 64, 78, 87, 103, 121, 120, 101],
#     [72, 92, 95, 98, 112, 100, 103, 99]
# ])

quant_table = np.array([    
    [6,  4,  4,  6,  10, 16, 20, 24],
    [5,  5,  6,  8,  10, 23, 24, 22],
    [6,  5,  6,  10, 16, 23, 28, 22],
    [6,  7,  9,  12, 20, 35, 32, 25],
    [7,  9,  15, 22, 27, 44, 41, 31],
    [10, 14, 22, 26, 32, 42, 45, 37],
    [20, 26, 31, 35, 41, 48, 48, 40],
    [29, 37, 38, 39, 45, 40, 41, 40]
])
quant_table = quant_table
pixels = np.zeros((128, 128))


idct_matrix = np.array([[0.35341683395063966, 0.4902357603574083, 0.46171452375250455, 0.41585984518107744, 0.35341683395063506, 0.2774638687951855, 0.19150988579907113, 0.0973885117086323], 
               [0.3534168339506351, -0.09738851170863172, -0.461714523752504, 0.2774638687951856, 0.35341683395063517, -0.4158598451810763, -0.19150988579907113, 0.49023576035740796], 
               [0.35341683395063744, -0.41585984518107694, 0.19150988579907188, 0.09738851170863226, -0.3534168339506352, 0.4902357603574081, -0.4617145237525051, 0.2774638687951858], 
               [0.35341683395063384, -0.27746386879518603, -0.19150988579907066, 0.4902357603574086, -0.3534168339506347, -0.09738851170863276, 0.46171452375250516, -0.41585984518107666],
               [0.3534168339506327, 0.09738851170863301, -0.46171452375250477, -0.2774638687951865, 0.3534168339506353, 0.4158598451810778, -0.19150988579907122, -0.49023576035740796], 
               [0.3534168339506375, 0.2774638687951857, -0.19150988579907083, -0.4902357603574077, -0.3534168339506347, 0.09738851170863252, 0.4617145237525044, 0.4158598451810766], 
               [0.3534168339506283, 0.41585984518107677, 0.1915098857990716, -0.09738851170863214, -0.35341683395063506, -0.4902357603574081, -0.4617145237525046, -0.2774638687951849], 
               [0.35341683395063334, -0.49023576035740785, 0.4617145237525045, -0.41585984518107694, 0.3534168339506349, -0.277463868795186, 0.19150988579907086, -0.09738851170863201]
               ])

for i in range(16):
    for j in range(16):
        dct_signal = np.array(list[i*8:(i+1)*8,j*8:(j+1)*8])


        divided = dct_signal/quant_table

        quantized = np.round(divided).astype(np.int64)
        recovered = quantized * quant_table 

        idct_signal = np.round(np.dot(idct_matrix, (np.dot(idct_matrix, recovered.T).T))).astype(np.int64)


        for p in range(8):
            for q in range(8):
                pixels[8 * i + p][8 * j + q] = idct_signal[p][q]

        pixels = pixels.astype(np.int64)

fig, axes = plt.subplots(1, 2)

axes[0].imshow(inpImg, cmap="gray")
axes[0].set_title('Image 1')

axes[1].imshow(pixels, cmap="gray")
axes[1].set_title('Image 2')

# Show the plot
plt.show()